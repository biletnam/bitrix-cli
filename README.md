# Описание

Bitrix CLI - набор инструментов командной строки для администрирования Bitrix. Полная переработка [этого инструмента](https://github.com/dbfun/tools/blob/master/bitrix).

В основе - [философия unix](https://ru.wikipedia.org/wiki/%D0%A4%D0%B8%D0%BB%D0%BE%D1%81%D0%BE%D1%84%D0%B8%D1%8F_UNIX).

Параметры передаются через STDIN или параметры, результат выводится в STDOUT, а ошибки - в STDERR.

Для запуска необходимо наличие PHP командной строки (пакет типа `php-cli`). Возможно указать произвольный интерпретатор PHP.

# Конфигурация

Конфигурация определяется через файл `~/.bitrix-cli` (для чего необходимо скопировать этот файл в домашний каталог) и переменные окружения. Если ничего не задано, используются умолчания.

Приоритет: окружение > файл конфигурации > умолчания.

Например, так можно определить путь до PHP через окружение:

```
export BX_PHP="/usr/bin/php7"
```

Если не установлено, используется значение `_BX_PHP` из `~/.bitrix-cli`.

Если ничего не передавать - используется PHP по-умолчанию (`which php`).

Возможно определить следующее:

* путь к PHP
* язык сайта
* уровень ошибок

# Составные части программы

* `bitrix test` - самотестирование: какая версия PHP будет вызвана, какие параметры будут переданы в PHP
* `bitrix element`, `bitrix section`, `bitrix iblock` - работа с инфоблоками: поиск, вывод содержимого, свойств инфоблока
* `bitrix component` - компоненты: поиск в файле
* `bitrix error` - вывод сообщений об ошибках
* `bitrix event` - события: поиск, вывод в различных форматах
* `bitrix user` - пользователи: поиск, вывод информации
* `bitrix file` - файлы: поиск, вывод информации и содержимого файла
* `bitrix option` - опции из БД
* `bitrix db` - параметры подключения к БД
* `bitrix php` - запуск сценария PHP с подключенным прологом (удобно для вывода переменных)

Обычно необходимо передать ID элемента через `--ID (число)` или `-i (число)` и указать формат вывода через `--view`, `--format`, `-v` или `-f` (это все алиасы).

Сейчас нельзя использовать plain-параметры, например `bitrix component index.php`. Возможно, следует воспользоваться https://github.com/pwfisher/CommandLine.php

# Использование

## Выходной формат

Формат вывода задается через `--view`, `--format`, `-v` или `-f` (это все алиасы). По-умолчанию используется `var_dump`.

* `var_dump`, `var_export` - используется соответствующая функция PHP
* `json` - в формате JSON `json_encode()`
* `id` - выводятся только id, которые были найдены по условию
* в удобном для чтения с экрана виде: `iblock`, `component`, `db`, `file`, `letter` (для событий)

## Получение элементов инфоблока

```
# Получение одного элемента
bitrix element -i1000
# Получение нескольких элементов
bitrix element -i1000 -i1001 --ID 1002 --ID 1003
# Так можно отсеять элементы, которых нет в базе данных
bitrix element -i1000 -i1001 -i1003 -f id
# Получение нескольких элементов, переданных через STDIN
echo -e "1000\n1001" | bitrix element
```

## Получение списка компонентов в файле

```
# явное указание файла
bitrix component -x index.php
# если файл не указывать, будет использован index.php
bitrix component
```

## Получение файла

```
# Получение информации о файле
bitrix file -i1000
# Сохранение содержимого файла
bitrix file -i1000 -f src > file.jpg
```

## Получение информации о пользователе

```
bitrix user --group 1 | bitrix user --modify active=0
```


## Получение информации о последних ошибках

```
bitrix error
```
